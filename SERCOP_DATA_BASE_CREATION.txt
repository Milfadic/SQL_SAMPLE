/*********************************************************************************************************/
/* Project:                     SERCOP	                                                                 */
/*                                                                                                       */
/* File name:                   SERCOP_datasetcreation_MF                                                */
/*                                                                                                       */
/* Description:                 - THIS FILES CONTAINS THE SQL CODE REQUIRED TO CREATE THE DATABASE                                                            */ 
/* Log file name:               Code_Dataset_Creation                                                    */
/* First logged:                2015 MARCH 15. Updated:	NOVEMBER 2015		                                         */
/* Programmed by:               Milenko Fadic                                                            */
/* Input  files :               NONE								                                     */
/* Temp   files:                NONE                                                                     */ 
/* Output files :               DATABASE                                                                 */
/*                                                                                                       */
/*********************************************************************************************************/



CREATE TABLE PROVINCIA
(
CODIGO NVARCHAR(20) NOT NULL Primary Key,
NUMERO NUMERIC(2) NOT NULL,
NOMBRE NVARCHAR(250) NOT NULL ,
REGION NVARCHAR(250),

)

CREATE TABLE CANTON
(
CODIGO NVARCHAR(20) NOT NULL Primary Key,
PROVINCIA NVARCHAR(20) FOREIGN KEY REFERENCES PROVINCIA(CODIGO),
NOMBRE NVARCHAR(2500) NOT NULL,
CAPITAL NUMERIC(1) NOT NULL ,
)


CREATE TABLE PARROQUIA 
(
CODIGO NVARCHAR(20) NOT NULL Primary Key,
CANTON NVARCHAR(20) FOREIGN KEY REFERENCES CANTON(CODIGO),
PROVINCIA NVARCHAR(20) FOREIGN KEY REFERENCES PROVINCIA(CODIGO),
NOMBRE NVARCHAR(2500) NOT NULL,
TIPO nvarchar(30), 
CABEZERA NUMERIC(1) NOT NULL,
)

/********************ENTIDADES****************************************************/


CREATE TABLE ENTIDAD_TIPO
(
CODIGO NVARCHAR(20) NOT NULL Primary Key,
DESCRIPCION1 NVARCHAR(250), 
DESCRIPCION2 NVARCHAR(250),
DESCRIPCION3 NVARCHAR(250),
)


CREATE TABLE ENTIDADES
		(
			RUC_ENTIDAD NVARCHAR(250) NOT NULL Primary Key,
			ARUC_ENTIDAD NVARCHAR(250) NOT NULL,
			NOMBRE_ENTIDAD nvarchar(2500) NOT NULL,
			PARROQUIA nvarchar(20) FOREIGN KEY REFERENCES PARROQUIA(CODIGO),
			CANTON nvarchar(20)  FOREIGN KEY REFERENCES CANTON(CODIGO),
			PROVINCIA NVARCHAR(20) NOT NULL FOREIGN KEY REFERENCES PROVINCIA(CODIGO), 
			TIPO NVARCHAR(20) FOREIGN KEY REFERENCES ENTIDAD_TIPO(CODIGO)
			)

/********************OBRAS***************************************************/

CREATE TABLE TIPO
			(CODIGO INT IDENTITY PRIMARY KEY,
			DESCRIPCION1 NVARCHAR(2500) , 
			DESCRIPCION2 NVARCHAR(2500) , 
			)  

			  

CREATE TABLE FORMA_PAGO
			(CODIGO INT IDENTITY PRIMARY KEY,
			DESCRIPCION1 NVARCHAR(2500) NOT NULL, 
			DESCRIPCION3 NVARCHAR(2500) , 
			) 

CREATE TABLE DIAS
			(CODIGO NVARCHAR(20) NOT NULL PRIMARY KEY,
			)  


 CREATE TABLE ESTADO
			(CODIGO INT IDENTITY PRIMARY KEY,
			DESCRIPCION1 NVARCHAR(2500) , 
			)  
			
--THIS TABLE IS MEANT TO INCLUDE ALL THE INFORMATION THAT IS NOT AVAILABLE IN THE SCRAP PART. IF THERE ARE ANY
--DISCREPANCIES, I CAN ALWAYS CHECK WITH THE ORIGINAL TABLE AND/OR FILES
			
CREATE TABLE OBRAS_MENOR_CUANTIA_SERCOP
			(
			CODIGO nvarchar(2500) NOT NULL Primary Key ,
			CODIGO_INTERNO nvarchar(2500) NOT NULL,	
			RUC_ENTIDAD nvarchar(250) NOT NULL FOREIGN KEY REFERENCES ENTIDADES(RUC_ENTIDAD) ,			
			VALOR_ADJUDICADO nvarchar(300) ,
			ESTADO  INT NOT NULL FOREIGN KEY REFERENCES ESTADO(CODIGO),
			)  

----------------------------------------------------------------------------------------------------------------		
CREATE TABLE CONTACTO_FUNCIONARIO
			(CODIGO INT IDENTITY PRIMARY KEY,
			EMAIL NVARCHAR(2500) NOT NULL, 
			)  
			
CREATE TABLE OBRAS_MENOR_CUANTIA_SCRAP
			(
			CODIGO nvarchar(2500) NOT NULL FOREIGN KEY REFERENCES OBRAS_MENOR_CUANTIA_SERCOP(CODIGO) ,
			ENTIDAD_NOMBRE nvarchar(2500) NOT NULL, 
			OBJETO_PROCESO nvarchar(2500) NOT NULL, 
			TIPO_COMPRA INT NOT NULL FOREIGN KEY REFERENCES TIPO(CODIGO),
			PRESUPUESTO decimal(10,2) NOT NULL ,
			TIPO_CONTRATACION INT NOT NULL FOREIGN KEY REFERENCES TIPO(CODIGO),
			FORMA_PAGO  INT NOT NULL FOREIGN KEY REFERENCES FORMA_PAGO(CODIGO),
			TIPO_ADJUDICACION INT FOREIGN KEY REFERENCES TIPO(CODIGO),
			PLAZO_ENTREGA NVARCHAR(20) NOT NULL FOREIGN KEY REFERENCES DIAS(CODIGO),
			VIGENCIA_OFERTA NVARCHAR(20) NOT NULL FOREIGN KEY REFERENCES DIAS(CODIGO),
			CONTACTO_FUNCIONARIO  INT NOT NULL FOREIGN KEY REFERENCES CONTACTO_FUNCIONARIO(CODIGO),
			ESTADO_PROCESO  INT NOT NULL FOREIGN KEY REFERENCES ESTADO(CODIGO),
			ESTADO_PROCESO_FINALIZADO INT NOT NULL  FOREIGN KEY REFERENCES ESTADO(CODIGO),
			) 
			
CREATE TABLE FECHAS
			(
			ACODIGO nvarchar(2500) NOT NULL PRIMARY KEY,
			CODIGO nvarchar(2500) NOT NULL FOREIGN KEY REFERENCES OBRAS_MENOR_CUANTIA_SERCOP(CODIGO) ,
			 Propuestas nvarchar(250) NOT NULL,
			Respuestas  nvarchar(250) NOT NULL,
			Adjudicacion nvarchar(250) NOT NULL, 
			Publicacion nvarchar(250) NOT NULL,
			Apertura_Ofertas nvarchar(250) NOT NULL, 
			Aceptacion_Proveedor  nvarchar(250) NOT NULL,
			Preguntas  nvarchar(250) NOT NULL,
			Convalidacion nvarchar(250) NOT NULL,
			) 

--THIS IS FOR 1_CALIFICACIONES TXT
		
CREATE TABLE REQUISITOS
		(CODIGO INT IDENTITY PRIMARY KEY, 
		DESCRIPCION1 nvarchar(250) NOT NULL,
		DESCRIPCION2 nvarchar(250) NOT NULL
		)



	CREATE TABLE REQUISITOS_OBRA
		(ACODIGO nvarchar(250) NOT NULL PRIMARY KEY ,
		CODIGO_OBRA nvarchar(2500) NOT NULL FOREIGN KEY REFERENCES OBRAS_MENOR_CUANTIA_SERCOP(CODIGO),
		REQUISITO INT  NOT NULL FOREIGN KEY REFERENCES REQUISITOS(CODIGO)
		)


--THIS IS FOR THE SUMMARY TO ADD CPC
CREATE TABLE CPC
		(CODIGO nvarchar(2500) NOT NULL , 
		CODIGOCPC NVARCHAR(250) NOT NULL ,
		DESCRIPCION nvarchar(250) NOT NULL,
		PRIMARY KEY (CODIGO)
		)


/********************PROVEEDORES****************************************************/

CREATE TABLE PROVEEDORES
			(
			ARUC nvarchar(2500) NOT NULL Primary Key ,
			RUC nvarchar(2500) NOT NULL,
			NOMBRE nvarchar(2500) NOT NULL,
			CIUDAD nvarchar(20)  Foreign Key REFERENCES CANTON(CODIGO) ,
			DESCRIPCION nvarchar(250) NOT NULL ,
			TAMANO nvarchar(250)
			) 


CREATE TABLE PROVEEDORES_IMPUESTOS
			(
			CODIGO NVARCHAR(25) NOT NULL PRIMARY KEY,
			ARUC nvarchar(2500) NOT NULL Foreign Key REFERENCES PROVEEDORES(ARUC),
			RUC nvarchar(2500) NOT NULL,
			DECLARACION_TAX DECIMAL(10,2) NOT NULL, --NOTE IF THE DECLARATION HAS NOT BEEN FILED, IT WILL BE REPLACED BY A 9999999
			DECLARACION_FX_TAX DECIMAL(10,2) NOT NULL, --NOTE IF THE DECLARATION HAS NOT BEEN FILED, IT WILL BE REPLACED BY A 9999999
			ANO NUMERIC(20) NOT NULL ,
			FORMA NVARCHAR(25) 
			) 

CREATE TABLE PROVEEDORES_INVITADOS
			(
			CODIGO PRIMARY KEY NOT NULL, 
			CODIGO_OBRA nvarchar(2500) NOT NULL FOREIGN KEY REFERENCES OBRAS_MENOR_CUANTIA_SERCOP(CODIGO),
			ARUC nvarchar(2500) NOT NULL Foreign Key REFERENCES PROVEEDORES(ARUC),
			RESPUESTA NVARCHAR(25) NOT NULL, 
			FECHA_INVITACION NVARCHAR(250) NOT NULL, 
			FECHA_RESPUESTA NVARCHAR(250) NOT NULL, 
			GANADOR NUMERIC(1),
			CALIFICA NUMERIC(1),
			MULTIPLES_INVITACIONES NUMERIC(1)
			) 
			
CREATE TABLE PREFERENCIA_REGION
			( 
			ACODIGO PRIMARY KEY NOT NULL,
			CODIGO_OBRA nvarchar(2500) NOT NULL FOREIGN KEY REFERENCES OBRAS_MENOR_CUANTIA_SERCOP(CODIGO),
			NO_PREF INT, 
			CANTON INT, 
			PROVINCIA INT,
			NACIONAL INT,			
			NO_PROVINCIA INT, 
			NO_CANTON INT, 
			) 
			

CREATE TABLE PROVEEDORES_Evaluacion
			(
			CODIGO PRIMARY KEY NOT NULL, 
			CODIGO_OBRA nvarchar(2500) NOT NULL FOREIGN KEY REFERENCES OBRAS_MENOR_CUANTIA_SERCOP(CODIGO),
			RUC nvarchar(2500) NOT NULL Foreign Key REFERENCES PROVEEDORES(RUC),
			REQUISITO INT FOREIGN KEY REFERENCES REQUISITOS(CODIGO)
			RESULTADO nvarchar(250) NOT NULL 
					) 
			
			
****************************************************

CREATE TABLE ORIGINAL_ALL_PURCHASES  (
[CODIGO] nvarchar(300),
[CODIGO_Interno] nvarchar(300),
[Fecha] nvarchar(300),
[ANO] nvarchar(300),
[MES] nvarchar(300),
[ESTADO] nvarchar(300),
[CPC] nvarchar(300),
[Tipo_Proceso] nvarchar(300),
[Clasificador] nvarchar(300),
[Tipo_compra] nvarchar(300),
[Agreg_Nac] nvarchar(300),
[Tamano_Proveedor] nvarchar(300),
[Nombre_Proveedor] nvarchar(300),
[Ruc_Proveedor] nvarchar(300),
[Origen_Proveedor] nvarchar(300),
[Nombre_Entidad] nvarchar(300),
[Ruc_Entidad] nvarchar(300),
[Provincia_Entidad] nvarchar(300),
[Valor] nvarchar(300)
)


CREATE TABLE COMPANIAS
(
EXPEDIENTE INTEGER NOT NULL,
RUC NVARCHAR(20) NOT NULL ,
CIIU NVARCHAR(20) NOT NULL,
CIUDAD NVARCHAR(20) NOT NULL ,--UPDATE, THIS IS BASED ON THE CANTON
CANTON NVARCHAR(20) NOT NULL FOREIGN KEY REFERENCES  CANTON(CODIGO), --UPDATE, THIS IS BASED ON THE CANTON
PARROQUIA NVARCHAR(20) FOREIGN KEY REFERENCES PARROQUIA(CODIGO), --THIS IS BASED ON CANTON 
PROVINCIA NVARCHAR(20) NOT NULL FOREIGN KEY REFERENCES  PROVINCIA(CODIGO),
 
CIUDAD_OPERACION NVARCHAR(20) NOT NULL,
FECHA_CONSTITUCION NVARCHAR(20) NOT NULL,
SITUACION_LEGAL NVARCHAR(550), 
TIPO_COMPANIA NVARCHAR(550) NOT NULL, 
OFICINA_CONTROL NVARCHAR(550) NOT NULL, 

CAPITAL_AUTORIZADO DECIMAL(10,2) NOT NULL, 
CAPITAL_SUSCRITO DECIMAL(10,2) NOT NULL, 
VALOR_NOMINAL DECIMAL(10,2) NOT NULL, 
BIENES_ESTADO NVARCHAR(250) NOT NULL, 

OBJETO_SOCIAL NVARCHAR(250),
PLAZO_SOCIAL NVARCHAR(250),
DESCRIPCION_1 NVARCHAR(2500),
DESCRIPCION_2 NVARCHAR(2500),


CORREO NVARCHAR(250),
CELUlAR INTEGER,
TELEFONO_1 INTEGER,
FAX INTEGER,
CASILLERO NVARCHAR(250),
NACIONALIDAD NVARCHAR(250),

CAMINO NVARCHAR(250), 
CALLE NVARCHAR(250), 
CIUDADELA NVARCHAR(250), 
INTERESECCION NVARCHAR(250), 
BARRIO NVARCHAR(250), 
CONJUNTO NVARCHAR(250),
BLOQUE NVARCHAR(250), 
PRIMARY KEY (RUC)
)



CREATE TABLE PERSONAS
(
RUC NVARCHAR(20) NOT NULL PRIMARY KEY ,
NOMBRE NVARCHAR(250) NOT NULL ,
CIUDAD NVARCHAR(20) ,--UPDATE, THIS IS BASED ON THE CANTON
CANTON NVARCHAR(20)  FOREIGN KEY REFERENCES  CANTON(CODIGO), --UPDATE, THIS IS BASED ON THE CANTON
PARROQUIA NVARCHAR(20) FOREIGN KEY REFERENCES PARROQUIA(CODIGO), --THIS IS BASED ON CANTON 
PROVINCIA NVARCHAR(20)  FOREIGN KEY REFERENCES  PROVINCIA(CODIGO),
) 



CREATE TABLE KARDEX
(
RUC_COMPANIA NVARCHAR(20) NOT NULL FOREIGN KEY REFERENCES COMPANIAS(RUC),
RUC NVARCHAR(20) NOT NULL FOREIGN KEY REFERENCES PERSONAS(RUC),
TIPO NVARCHAR(250) ,
FECHA NVARCHAR(250) NOT NULL,
ESTADO NVARCHAR(250)  NOT NULL,
VALOR DECIMAL(10,2) NOT NULL
)


CREATE TABLE ADMINISTRADORES
(
RUC_COMPANIA NVARCHAR(20) NOT NULL FOREIGN KEY REFERENCES COMPANIAS(RUC),
RUC NVARCHAR(20) NOT NULL FOREIGN KEY REFERENCES PERSONAS(RUC),
PAIS NVARCHAR(250) ,
POSICION NVARCHAR(250) NOT NULL,
FECHA_NOMBRAMIENTO  NVARCHAR(250)  NOT NULL,
PERIODO NVARCHAR(250)  NOT NULL,
FECHA_REGISTRO_MERCANTIL  NVARCHAR(250)  NOT NULL,
ARTICULO NVARCHAR(250)  NOT NULL,
NUMERO_REGISTRO_MERCANTIL  NVARCHAR(250)  NOT NULL,
TIPO NVARCHAR(250)  NOT NULL,
)



create table companias_disueltas 
				  (ruc nvarchar(20) foreign key references companias(ruc), fecha nvarchar(20), notas nvarchar(2500))


create table companias_balance_tracking 
(
CODIGO NVARCHAR(250) PRIMARY KEY,
RUC_COMPANIA	nvarchar(20) FOREIGN KEY REFERENCES COMPANIAS(RUC)	,
EXPEDIENTE	nvarchar(250)		,
FECHA INTEGER,
PDF2TXT_TRIED	BIT		,		
PDF2TXT_SUCCESS	BIT		,
OCR_NEEDED	BIT		,
OCR_DONE	BIT		,
OCR_OUTCOME	NVARCHAR (25),
MANUAL_ENTRY_NEEDED	BIT		,
MANUAL_ENTRY_DONE	BIT		,
XSLT_DONE	BIT		,
ENTERED_DB	BIT		,
)
			


/*
drop table  COMPANIAS_BALANCES 
CREATE TABLE COMPANIAS_BALANCES (
ACODIGO NVARCHAR(250) primary key  , 
RUC NVARCHAR(20), 
ANIO NUMERIC(20) NOT NULL, 
CODIGO NVARCHAR (250) FOREIGN KEY REFERENCES BALANCES_ITEMS (CODIGO ), 
VALOR DECIMAL(10,2))
*/
/*
UPDATE #ACTIVOS_2 SET EXPEDIENTE=B.RUC
FROM #ACTIVOS_2 A INNER JOIN COMPANIAS B 
ON A.Expediente=B.EXPEDIENTE
*/
			
ALTER TABLE COMPANIAS_BALANCES ADD BATCH NVARCHAR(250)
